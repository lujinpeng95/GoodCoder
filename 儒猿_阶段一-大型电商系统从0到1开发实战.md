# 01包含16个中心的大型电商系统==需求分析==

##1-1 思路与内容

- 思路：实际上就是用一个完全==真实的项目背景==来驱动，在这个有复杂业务场景的项目中，去讲解各个==技术是如何落地使用==的（体现技术迭代过程）

- 内容概述

  - 初始【基础】：每秒并发在**10/s**左右（用户量几十万）
    - 技术：spring boot
    - 设计：架构设计的流程，架构设计的几个视图，画哪些架构图，架构怎么去做设计，概要设计，详细设计，设计评审
    - 流程与规范：编码规范，单元测试规范，多环境测试规范（集成测试、功能测试、性能测试、并发测试、QA测试），上线发布规范，回滚规范，监控规范
    - 详细设计：**设计模式**
  - 中期【效能】：高峰并发可能就**几百**了（用户量百万-<span style="color:red">微服务阶段</span>）
    - 拆分：微服务化，拆分成多个服务
    - 效率：**微服务**+DevOps+敏捷开发+敏捷项目管理
  - 后期【并发】：并发可能都达到**几千**qps（Queries Per Second意思是“每秒查询率”；用户量千万-<span style="color:red">高并发阶段</span>）
    - 技术改造：redis缓存、mysql分库分表、mq、elasticsearch、nginx、集群
    - 新问题：高可用，安全性，高稳定性，扩展性，伸缩性，架构问题

  - 亿级流量（会独立出 基础架构组）
    - 基建：研发自己的基础架构，基础**中间件**
    - **大数据**
    
    
  

【本章全为产品设计文档（PRD，Product Requirement Document），详见文件夹 『01_包含16个中心的大型电商系统需求分析第一周课程资料』】



## 1-2 大型电商系统的整体架构分析

- 电商的分类：本课程关注B2C
  - B2C：business to customer；天猫超市，淘宝直营店
  - C2C：customer to customer；淘宝个体户
  - O2O：online to offline；美团
- B2C分类：本课程关注②的实现
  - ① 电商网站，仅仅提供一个平台，实际卖东西的是第三方的一些公司和厂商：直营店
  - ② 电商网站，自己去采购一些商品，自己对外售卖：天猫超市
  - ③ 实际上来说，现在大部分的B2C都是两者结合



### 大型电商系统组成结构（16-32）

- ==16个中心+32个服务==

![02_大型电商系统的整体架构](https://mdpic01-1306646166.cos.ap-shanghai.myqcloud.com/mdPic/02_%E5%A4%A7%E5%9E%8B%E7%94%B5%E5%95%86%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84.png)



#### 1、权限中心

- 权限管理服务
  - RBAC模型（Role-Base Access Control），基于角色的一个权限模型
  - 多种岗位，不同的角色可以操作不同的模块与功能的权限。
  - 复杂的系统，可能还包括：黑名单服务、操作日志服务

- 操作日志服务
  - 记录每个账号每天进行了什么操作。
  - 对账号的异常行为进行审计。




#### 2、商品中心

- 商品管理服务
  - 计划售卖的东西，库存数量。供应商采购。
  - 显示商品到网上买，商品信息审核、上架

- 商品基础数据服务
  - 属于什么品牌，属于哪个分类，一些商品属性



#### 3、WMS-仓储管理服务

- WMS（Warehouse Management System，仓储管理服务）

- 基础数据服务：仓库信息、货拉信息
- 仓储管理服务



### 3大块8核心

- 3大块：

  - 管理后台：给公司内部各个部门使用的
    - 包含的部门包括：运营、采购、招商、财务、客服，等等
    - 包含的子系统包括：系统管理、采购管理、销售管理、库存管理、会员管理、商品管理、订单管理、客服管理、商家管理、财务管理、数据统计、供应商管理，等等

  - 商家后台：给入驻电商网站的商家使用的
    - 如果网站是自营商品，自行采购和售卖的话，是不存在入驻商家这一说法的，那么此时这块指的就不是商家，可能就是公司自己的商品售卖部门
    - 包含的子系统包括：店铺管理、商品管理、订单管理、营销管理、财务管理、客户管理、数据统计，等等
  - WMS（仓储系统）
    - 因为一般公司的仓储工作人员，跟其他部门的工作人员，办公地点不是在一个地方的。公司总部一般在办公楼里面，而仓储工作人员一般在仓库里面。所以这个WMS系统可以单独拉出来

- 8核心：商品、促销、购物车、订单、库存、物流、支付、会员



#### 1、管理后台

- ① 系统管理
  - 这块主要是用来创建后台账号，分配权限，监控操作日志等操作的，一般只有整个电商后台系统的少数几个管理员，才有权限使用
- ② 采购管理
  - 一般如果是自营的电商网站，都需要自己进行采购管理，核心是采购单，包含了采购计划、智能采购、供应商、仓库等信息，同时有采购入库和采购退货等核心流程，属于进销存中的<span style="color:red">“进”</span>
- ③ 销售管理
  - 主要是针对网站中商品的销售设置的模块，包含了网站前台页面的CMS系统、专题页面、促销特卖活动、优惠券等等，都在这里，主要是针对如何让商品更好的售卖出去，属于进销存中的<span style="color:red">“销”</span>
- ④ 库存管理：主要是对商品的库存进行管理的，属于进销存中的<span style="color:red">“存”</span>
- ⑤ 会员管理：主要是进行会员体系的管理，同时针对用户进行数据收集、打标签、筛选，然后针对用户进行精准营销
- ⑥ 商品管理：商品基本信息，包括了分类和品牌，等等；商品来源包括了网站自营和第三方商家
  - 包含了商品的新建/编辑，第三方商品审查，商品上下架，商品查询，商品管理（组合、定价、库存，等等）
  - 商品基础数据管理：类目、属性与品牌的管理
- ⑦ 订单管理：主要是管理用户下的订单，包括订单流转，订单查询
- ⑧ 客服管理：系统涵盖售前、售中、售后，售前是IM工具，售中是企业知识库，售后是工单系统
- ⑨ 商家管理：商家入驻，商家信息管理，同时对商家店铺进行管理
- ⑩ 财务管理：退款、与第三方商家结算、与供应商结算、往来现金和账款的管理
- ⑪ 评价管理：管理所有商品的评价数据
- ⑫ 数据统计：看到流量、转化、交易、商品、用户、商家等各个维度的数据
- ⑬ 供应商管理



#### 2、WMS（仓储系统）

> WMS（Warehouse Management System，仓储管理服务）

- ① 系统设置：设置仓库的基础信息，包括了商品、库位和设备，仓库人员账号、操作权限以及操作日志

- ② 入库管理：包括采购入库、调拨入库、退货入库、生产入库，有入库流程和入库单
- ③ 出库管理：包括销售出库、调拨出库、采购退货出库，出库流程包括了出库单、捡货、验货、称重、出库
- ④ 库存管理：
  - 管理商品库存数量，包括库存查询、库存盘点、库存预警、库存调整、库存同步，等等，库存数据和出库单和入库单关联在一起
- ⑤ 单据管理：包括打印快递单、捡货单、发货单、小票、盘点单、调拨单



#### 3、商家后台

- ① 店铺管理：店铺信息设置、店铺装修、店铺子账号管理
- ② 商品管理
  - 商家后台的商品管理和管理后台的商品管理，是关联起来的
  - 商家可以在这里发布商品、审查商品、商品分组、设置商品状态
- ③ 订单管理
  - 用户在电商网站支付之后，订单就会推送到商家后台，商家可以在这里看到订单信息，然后进行发货

- ④ 营销管理：基于电商网站提供的营销渠道，比如搜索关键词竞价排名，可以推销自己的商品
- ⑤ 财务管理：与电商网站进行财务结算相关的模块
- ⑥ 用户管理：包括这个店铺的用户信息，以及售后问题处理，都在这里
- ⑦ 数据统计：店铺的经营数据统计，都可以在这里看到



## 1-3 电商系统整体运行流程（ 信息流、物流、资金流）

- 关注电商三流 --- 信息流、物流、资金流

 ![03_电商网站的黄金购物链路分析](https://mdpic01-1306646166.cos.ap-shanghai.myqcloud.com/mdPic/03_%E7%94%B5%E5%95%86%E7%BD%91%E7%AB%99%E7%9A%84%E9%BB%84%E9%87%91%E8%B4%AD%E7%89%A9%E9%93%BE%E8%B7%AF%E5%88%86%E6%9E%90.png)

### 1、自营商品进销存流程

流程说明：【<span style="color:red">电商三流---信息流、物流、资金流</span>】

- 给自营商品部门开通账号权限

- 自营商品部门在==供应商管理模块==中，录入供应商信息

- 自营商品部门在==商品管理模块==创建自营商品信息
- 接着通过==采购管理模块==，去创建一个采购单，此时采购单会走线下流程，由采购人员跟供应商去沟通，让供应商开始提供货物，供应商会通过物流商将商品运输到我们指定的仓库中去
- 采购单会同步到调度中心去，调度中心会创建一个采购入库单，跟WMS系统通信，让WMS系统保存这个采购入库单
- 走线下的物流，供应商的货物会运输到我们的仓库里面去，到仓库里之后，仓储工作人员，会负责将这些商品按照调度中心的指示，上到对应的货位上面去，这里要走一个线下的入库流程
- 仓储工作人员，在货物都完成入库之后，会编辑一下这个采购入库单，采购入库单会让仓储管理人员去审核
- 审核通过之后
  - 一方面会走财务中心进行结算和打款
  - 另一方面会更新自己本地的商品库存、调度中心的商品库存、库存中心的商品库存，这个库存就可以在网站上看到了
- 此时用户进入电商网站，就可以看到有库存可售卖的商品，同时对商品查看详情页信息，并且下单支付和购买，这里也会走系统的财务管理模块进行资金结算
  - 当然这里，网站的运营人员通过销售管理模块中的各种促销活动的设置，也可以对一些商品进行促销活动，也可以吸引用户过来购买
- 用户下单时，会在订单管理模块中创建一个订单
- 创建订单时
  - 需要先从商品管理模块获取商品数据，从促销管理模块获取商品促销数据，从会员管理模块获取会员数据
  - 然后需要对库存管理模块中的商品库存数量进行锁定
  - 接着需要通过物流管理模块来计算运费 
  - 最后通过上面所有的数据，可以生成一个订单出来
- 接着用户对订单确认之后，可以进行支付，通过支付管理模块进行订单支付
- 此时订单信息会同步打通WMS系统，创建一个出库单，此时仓储管理人员需要根据创建出来的出库单在仓库中进行出库流程（捡货、验货、称重、出库），然后走线下的物流流程，比如找第三方物流供应商，给他们快递单，让他们发货
- 接着用户可以看到这个商品的物流状态，如果与物流系统打通，那么甚至可以查看到整个配送的全过程
- 接着物流供应商就会将这个商品发送到用户手上
- 如果用户拿到货之后需要退货，那么这个时候需要在网站上申请退货，此时会在客服系统中创建一个退货工单
- 接着用户会通过线下物流服务商，将商品寄送回网站
- 收到商品之后，售后人员需要验货，并且通过客服系统更新退货商品信息，同意退款，此时通过财务管理模块进行退款资金结算
- 同时成功退款之后，售后人员还需要将商品退回仓库，此时仓库收到之后，会再开一个入库单，表明是退货入库，同时也会关联更新WMS的库存数量，以及管理后台库存管理模块中的库存信息

 

###2、第三方商品进销存流程

- 第三方商家通过网站提供的商家入驻申请流程，提交入驻申请

- 此时入驻申请会转到管理后台中的商家管理模块中，在这里工作人员需要对入驻商家申请进行审核

- 审核通过之后，就会自动为商家创建一个店铺出来，这个店铺里就包含了商家的基本信息
  - 然后商家就可以设置自己更多的一些信息，包括店铺的装修
  - 同时商家可以通过商家后台的商品管理功能，发布自己的商品，发布后的商品就会在网站上显示出阿里

- 然后用户进入电商网站，就可以看到这些商品，同时下单支付和购买，此时会走财务资金结算，包括了与网站的资金结算，还有与第三方商家的资金结算

- 同时这个订单信息会进入到商家后台的订单管理模块中

- 商家会看到这个订单，然后从自己的仓储中捡货和发货，通过第三方物流发货到用后手中

- 用户收到商品后，如果要申请退货，那么需要点击申请退货，此时会在商家后台的售后管理模块中显示售后信息

- 然后用户需要将商品寄送回第三方商家指定的地址中

- 第三方商家收到退货之后，需要执行退款，此时会走财务管理模块的结算，将款项退还到用户账号中

  

###3、用户前台功能

 网站首页

注册与登录（认证）

搜索结果页

商品详情页

促销活动页

购物车

下单支付

已购买商品（查看发货状态、申请退货）

对商品发表评论

 

###项目补充说明

- 本质：根据对电商的理解，从前到后，从后到前，理解、抽取出来的一个较为完整，较为真实的这么一个电商系统的完整架构，和完整的供应链到购物的链路和流程
- 原因：就目前的这16个中心，32个服务，足以<span style="color:red">支撑后面所有的技术和架构的讲解</span>。【课程技术内容为核心】

- 其他：随着讲解的深入，到后面，可能会增加更多的中心和服务。促销，促销活动/优惠券。拼团，秒杀。支付中心，支付网关，对接多种第三方支付平台，资金清算，预警，很多东西。基于大数据的搜索系统。

 

- 是否可用于找工作：
  - 不要生搬硬套，对很多的细节还是做了很多简化的处理的，有些同学以前做过小型电商网站，或者是以后可能也会去一些电商公司去工作，绝对不可能说跟这个完全100%一样
  - 不懂电商的人可能还能忽悠一下。懂电商的，问一问具体的细节，你就完了
- 求职
  - 1对1指导每个人<span style="color:red">自己的项目经历</span>，将技术和架构融入你熟悉的做过的业务领域中；
  - 工作履历的梳理和优化，简历怎么写，面试；
  - 职业生涯怎么走怎么发展

 

- 课程规划
  - 对接下来十来讲做一个展望，至少是一个中心一个课时（16个中心，32个服务）
  - 每个中心，会结合这个大的业务流程，去梳理里面的细节
  - 每个中心的每个模块，我们都要去画模块的功能流程图，跟其他的外部子系统是在哪个环节，如何对接的，要提供哪些接口出去，传输什么数据，数据有哪些字段  



## 1-4 权限中心的需求分析

内容：账号、角色、权限、操作日志



【具体查看『 04_权限中心的需求分析（账号、角色、权限、操作日志）.docx』】







##1-5 商品中心的需求分析（基础数据、商品管理）

- SKU：Stock Keeping Unit，最小库存单位，最小的商品单位，比如iPhone 7 Plus 128G 银色，就是一个SKU（能唯一定位到一种商品）

  ![image-20220527175125013](https://mdpic01-1306646166.cos.ap-shanghai.myqcloud.com/mdPic/image-20220527175125013.png)

- SPU：Standard Product Unit，产品单元组合，比如iPhone 7 Plus，就是一个SPU，其实类似一个商品的概念吧。但是iPhone 7 Plus是不能具体指代哪个商品的，因为iPhone 7 Plus有很多种，比如不同的内存大小+不同的颜色，就可以组成不同的手机

  - 我们一般来说，所说的一个商品，我们指的是什么呢？说的是一个SPU

  ![image-20220527174954691](https://mdpic01-1306646166.cos.ap-shanghai.myqcloud.com/mdPic/image-20220527174954691-3645021.png)

- 类目：就是SKU所属的分类

- 属性：关键属性、销售属性、非关键属性、导购属性，4种。

  - 关键属性：SKU

  - 销售属性：SPU

  - 非关键属性：规格参数等

  - 导购属性：可以用来在商品列表页中作为筛选条件的

    ![image-20220527175249158](https://mdpic01-1306646166.cos.ap-shanghai.myqcloud.com/mdPic/image-20220527175249158.png)

 



- 主流程

（1）采购商品

（2）前台页面

（3）购买商品

（4）商品退货





![15_一张思维导图带你梳理电商系统业务需求](https://mdpic01-1306646166.cos.ap-shanghai.myqcloud.com/mdPic/15_%E4%B8%80%E5%BC%A0%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE%E5%B8%A6%E4%BD%A0%E6%A2%B3%E7%90%86%E7%94%B5%E5%95%86%E7%B3%BB%E7%BB%9F%E4%B8%9A%E5%8A%A1%E9%9C%80%E6%B1%82.png)





# 02 站在架构师的角度为团队设计==软件开发流程和规范==

- 本周资料里的06、011、012、016、017、018讲没有提供课程资料

- 电商项目的完整版文档：在104讲和289讲的课程资料里有。

- 阶段一代码下载地址：
  链接：https://pan.baidu.com/s/142GwG-mj6LjoNOoRYjEfNw 
  提取码：d0c6 



##2-1 授课思路介绍

- 目的：要把之前分析过的电商系统v1.0需求全部做出来，形成一个电商系统v1.0版本，认为是一个电商系统的雏形
- 涉及技术：<span style="color:red">软件工程、项目管理、Spring Boot、设计模式</span>



###2-1-1 软件工程

- 关键点：学习软件工程，靠的不是大学里的课本，你需要的是真正在简单了解整个软件工程的流程之后，快速的去运用整个软件工程的流程和思路去做一个项目出来。
- 概括软件工程：<span style="color:red">就是从0开始如何完成一个软件项目，涵盖了做一个软件项目的所有的流程</span>



- 【大白话描述】做的第一件事情，一定是制定一份这个项目开发的软件工程的流程与规范：第一步做什么？第二步做什么？如何一步一步的将一个项目给干出来？
  - 这个过程，就是一个软件工程的流程 -> 每个步骤到底要怎么做，要按照什么统一的规范来做，软件工程的规范
  - 在团队里面就会说是**系统开发的流程和规范** （专业术语就是 **软件工程的流程和规范**）
- 经典书目：《软件工程》（https://baike.baidu.com/item/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B%EF%BC%88%E5%8E%9F%E4%B9%A6%E7%AC%AC9%E7%89%88%EF%BC%89）
- 概括：如下的软件工程的流程，基本上就完全涵盖了标准软件工程的核心流程，其他部分（参照《软件工程》目录）的说明如下
  - 安全性和可靠性（安全架构、可靠性架构，后面讲解），
  - 高级软件工程（SOA、分布式、嵌入式，有些到了**微服务架构**会详解，有些不是我们的范围，到了后面会讲解）
  - 软件项目管理：就是本课程中的『项目管理』（<span style="color:red">软工是规范；项目管理是具体实施规范的方法</span>）
- 课程目的：
  - 【要求】作为一个架构师，为自己要负责的项目，**定义好一整套的软件工程流程，同时对流程中的每个步骤定义好规范**
  - 【实践】基于**真实的**电商系统项目来完整执行和实施一整套的软件工程流程和规范



#### 1、业务调研

- 如果在互联网行业里，这个业务调研，不是我们做的；产品经理的角色，跟系统的用户去聊，去调研需求，梳理出来一份**产品设计文档**，有的时候也可以叫做**业务调研文档**（通过『业务调研』 梳理出『 产品设计』）

- 定义：<span style="color:red">主要是完全跟技术无关，站在业务的角度去定义系统要干嘛</span>
- 目的：产出 **业务流程图** ---- 泳道图，一级业务流程+二级业务流程
  - ① 系统多个模块的整体业务流程
  - ② 每个模块内部的业务流程
- 其他：
  - 组织结构图：部门+岗位
  - 业务表单
  - 业务需求



#### 2、需求分析

- 架构师负责
- 定义：<span style="color:red">站在技术的角度，去分析系统要干嘛</span>
- 用例图
  - 用例表：用例名称+多个参与者+每个参与者对这个用例做的事情
  - 用例描述+用例流程（泳道图）
  - 用例图：参与者+用例，一个用例就是一个功能需求
  - 用例划分
    - 每个模块都划分出对应的用例来
    - 从业务流程图的运行节点中，抽取用例

- 领域类图：主要根据业务表单来抽象

- 非功能需求
  - 物理部署需求
  - 实施需求
  - 易用性需求
  - 性能需求
  - 可靠性需求



#### 3、概要设计

- 架构师一个人去完成
- 产出：
  -  逻辑架构图：根据需求，画出来逻辑上，系统要**长成什么样子**
  - 运行架构图：时序图、活动图（可选）、状态图（可选），系统的逻辑架构有了，系统**跑起来是什么流程**
  - 物理架构图：组件图、配置图，系统长什么样子，系统跑起来流程是什么，系统真正**怎么去部署**
- 概要设计评审



####4、详细设计

- 下推给项目组里的每个人去做

- 产出：

  - 数据架构图
    - 数据库ER模型图
    - 数据库逻辑设计图
    - 数据库物理设计图

  - 接口设计
  - 开发架构图：实现类图、包图
  - 系统运行流程图（活动图）
  - 测试用例设计
    - 单元测试用例设计
    - 冒烟测试用例设计

  - 日志设计

- 详细设计评审



#### 5、项目管理计划

- 定义：每个人给出自己的排期计划
- 产出
  -  活动图
  - 网络图
  - 进度计划（甘特图）
  - 资源配置



#### 6、工程初始化

- 每个人本地的开发环境搭建

- 资源申请：机器、数据库、缓存、MQ，包含了各个环境的资源申请

- 数据库初始化

- 代码初始化和上传



#### 7、 版本控制/编码开发

- 指定版本分支的拉取规范；按如上流程进行代码开发



####8、系统测试

- 单元测试（白盒测试）

- 冒烟测试

- 静态代码扫描

- 代码审查（CR，code review）

- 集成测试（联调测试，也可能是RD自己干，不是QA干）【组件测试】

- 系统测试（QA去干，黑盒测试）

- 验收测试（让业务需求方来试用一下，验收一下，一般来说，互联网行业里做验收测试的，一般是产品经理，PM）



#### 9、系统上线/系统运维

- 跟进bug的反馈，排查线上日志，解决bug



### 2-1-2 项目管理

> 软件工程和项目管理，密不可分
>
> 已经知道整个软件的流程和每一个步骤的规范要做什么，要怎么做。但是你如何带着一个团队，给他们分配好任务，带着他们一步一步的把这个流程全部做完呢？
>
> 要做到这一点，就是要依靠项目管理，对整个项目进行管理和把控，确保说带着一个team可以把你定义好的一整套东西全部做出来



**概念：**

- 传统概念：项目管理计划、项目执行和监控、风险管理、变更管理、质量管理（配置管理+测试管理+缺陷管理），5大过程域、9大领域、44个定义

- 当前不讲，随着项目复杂，一步步深入

  

**瀑布式 vs 敏捷式**

- 瀑布模型：**其是在一个项目从0到1的时候，采取瀑布式的方式来做，是挺靠谱的。**(需求变动是比较少的，还没有涉及到终端用户的反馈，其实就是一个初始产品的研发）
- 敏捷开发：**1到10的时候**，到微服务的环节，本来就要涉及到微服务的持续集成、持续交付、敏捷开发、敏捷项目管理



**站在互联网项目的角度进行项目管理**

- 传统IT & 互联网
  - 传统IT行业（为、中兴、神州数码、联想、用友）：拆分是比较细的，可能是这样的，一个team内部
    - 【资源&考核】有专门的做团队管理的leader：负责团队人员招聘、绩效；
    - 【设计】专门的架构师：就负责架构设计；
    - 【实施】项目经理：就是负责对设计好的架构，进行项目全生命周期的一个管理和负责
  - 互联网：PM、RD、QA
    - PM负责设计产品 -> RD负责开发（后端RD，前端RD，数据RD） -> QA负责测试
- 【本课程按<span style="color:red">技术专家</span>的标准讲解，包括招聘等团队管理】**技术专家**的职级，兼任了三个岗位，<span style="color:red">团队管理、架构设计、项目管理</span> 
  - 既要负责人员的招聘，打绩效，职级晋升评审；
  - 也要负责整体的技术规划，核心项目的架构设计；
  - 同时也要做重要的项目进行项目管理



**课程目标（管理方面）**

- 站在架构师的角度来制定项目**管理规范**
- 作为一个架构师来完整管理和把控整个**项目流程**
  - 模拟一个1+4的小team来进行项目管理
  - 你一个架构师，带了4个小弟，带着4个小弟一块儿来干活儿



### 2-1-3 涉及技术

#### 1、Spring Boot项目实战

**背景**

- 以前的技术框架的大路货，通用货，每个人都会的东西（每个公司，每个工程师，都必须掌握的一些东西，就是用这套最基础的框架来开发项目的），在2010年左右，是SSH2，Struts2+Spring+Hibernate
- 后来可能在2013年左右，大路货变成了，SSM，Spring Web MVC + Spring + Mybatis
- <span style="color:red">2017年兴起，Spring Boot</span>

**优点**

- 以前：





# 03 Spring Boot 从零开始快速上手

## 3-1 学习思路

- 内容与学习思路：Spring Boot，设计模式
  - **快速**学习 -> 
  - 技术储备 -> 
  - 模拟公司里的技术调研 -> 
  - 大面积的将这些技术运用到有真实复杂业务场景的**项目中**去



### 3-1-1 为什么是spring boot

- spring boot框架：作为开发spring项目的一个脚手架（<span style="color:blue">脚手架，类似于一个封装在各种技术之上的一个基础框架，基础模板</span>）。
- 为什么选它：Spring Boot是spring官方社区推出的，**设计思想，架构思想**，是更好的，更加优雅的

| Spring ：大量需要手工处理（启动、开发、测试、部署、监控）    | Spring Boot                                                  |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 1、版本混乱，**依赖冲突**                                    | spring boot负责统一各个依赖的版本，保证**兼容**              |
| 2、基于xml格式的**配置文件**，对各种技术框架进行大量的繁琐配置 <br>（mvc-servlet.xml，applicationContext.xml，mybatis-config.xml，web.xml） | 大量基于按照约定的自动配置；<br>少量基于注解、application.properties 配置 |
| 3、测试：与**tomcat**等web容器整合起来才能测试               | **内嵌**的 tomcat web容器                                    |
| 4、测试：自己导入测试**组件依赖**（junit、hamcrest、mockito） | 一键引入测试组件依赖                                         |
| 5、打包：配置**打包插件**                                    | 默认声明插件，支持打包可执行 jar、war 包                     |
| 6、监控：无较好方法（JVM 堆栈等）                            | 默认支持大量的线上应用的监控metrics                          |



### 3-1-2 如何学习框架型技术

- 技术分类（5类）：<span style="color:red">**框架性的技术，中间件的技术；架构，项目经验；底层技术**</span>
  - 中间件：**非常非常重要，务必掌握80%的核心功能，尽可能在项目中实践这80%的核心功能；同时尽量对重要的中间件，都要剖析源码。**（深刻理解分布式的消息、缓存、存储、搜索，redis内核源码、zookeeper内核源码、kafka内核源码、elasticsearch内核源码。对中间件，其实会用就很厉害了）

- 框架性技术（spring boot，spring，spring mvc，mybatis）学习思路：

  - ① 学会用：28法则（**迅速**学会20%，其他搜索引擎）

  - ② 学习**重点是源码**：<span style="color:red">设计思想，架构原理，技术亮点</span>（如果让你手写，能写出来吗）

    - 定位源码**处理报错**：异常栈进行分析

    - **系统设计**：大量的借鉴开源框架源码中的设计思想、架构思想、核心技术，应用到自己的系统设计中

    - 学**新知识**：内功修为深厚，会发现大道相通
      - struts2+spring+hibernate -> spring mvc+spring+mybatis -> spring boot+spring mvc+spring+mybatis -> spring cloud+spring boot+spring mvc+spring+mybatis

- 思路目的：工作（用） + 面试（源码）

  - 90%的人靠自己读源码，不现实，功力不够，读不会，读不懂；或没法彻底吸收，融会贯通。
  - 真正读懂后，别人就不可能随便赶上了



### 3-1-3 Spring boot框架学习思路

- 错误思路：书、视频（大而全，专注完整功能）

  - ① 不知道使用场景
  - ② 容易忘记

- 正确思路：<span style="color:red">我做过，而不是我学过</span>

  - 应用于实践

  - 分阶段学习

    - Step01：20%核心功能（核心源码）

      ```
      （1）Spring Boot快速入门
      （2）Spring Boot与Spring MVC+Spring+MyBatis的整合使用以及RESTful接口的支持
      （3）Spring Boot框架配置
      （4）Spring Boot单元测试
      （5）Spring Boot打印日志
      （6）Spring Boot应用部署
      （7）Spring Boot应用监控
      ```

    - Step02：Redis 整合（剖析 spring boot与 redis 整合部分源码）



#### 小阶段==不学什么==

> <span style="color:red">注意，是不学什么！</span>



- ① spring boot 与 thymeleaf、freemarker 等模板技术的整合：过时
  - 目的：纯碎关注后台架构，提供RESTful接口或者是rpc接口给前端工程师调用
  - 原因：主流趋势是前后端分离，我们后端工程师不再关注页面上的东西。（还不分离的公司没前途）
  - 【注意】：后面做**高并发**系统架构的时候，一定会涉及到大型电商系统的复杂的**页面静态化架构**，那个时候我们再来结合具体的架构和项目讲解与**模板技术**的整合
- ② Spring Boot 与 Spring Data JPA的整合：过时
  - JPA：Java Persistence API，java持久化API，ORM的概念（即原来的 hibernate，不需要你写sql，直接面向对象去操作和开发）。开发效率快，好维护，但性能不高（适合传统IT行业）
    - 【注意】<span style="color:red">java工程师精通写sql必须的</span>
- ③ Spring Boot与中间件技术的整合：暂时不学（快速原则）
  - 中间件：mongodb、redis、elasticsearch、cache支持、分布式session支持、zookeeper、kafka
  - 跟着项目走，使用的时候学
- ④ spring boot与jdbcTemplate的整合：太原始
- ⑤ spring boot与websocket、webservice的整合
  - websocket：用于特定系统（社交聊天、弹幕、网页游戏、股票基金实时价格、体育实况更新、视频会议、在线教育，等等），后续视情况学习
    - 常用于浏览器和服务端进行**频繁大量的通信**，就是浏览器需要主动跟服务端进行频繁的大量的交互，不断的刷新和更新数据。
  - webservice：微服务天下，这类webservice，SOA技术被淘汰
- ⑥ spring boot与安全技术的整合：后续**安全性架构**中专门讲解 spring security，oauth2
- ⑦ spring boot对定时调度的支持：会用到，不会专门讲解





## 3-2 快速上手体验

> maven 是基础中的基础，需要先学好



### 上手

1、创建一个空的maven工程

2、在pom.xml中引入spring boot的依赖

- spring-boot-starter-parent：源码分析的起点（所需包、插件的定义，且无版本冲突）
- spring-boot-starter-web：核心源码（变为一个web 工程）；无侵入式的自动化设计思想

```xml
<!-- 继承spring boot的父工程 -->
<!-- spring boot父工程直接约束了常用依赖的版本 -->
<parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>1.5.9.RELEASE</version>
</parent>

<!-- 添加一个支持web应用的spring boot依赖 -->
<!-- spring boot会根据我们引入的依赖，判断出来我们要开发一个web工程 -->
<!-- 接着会对web工程需要的东西，比如内嵌的tomcat服务器、spring mvc、web.xml，自动进行配置 -->
<!-- 只需写一个 spring mvc的 controller，启动一个 main 类，spring boot直接就会启动一个 tomcat 服务器，部署 web 工程，访问浏览器，直接就可以测试了-->
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
</dependencies>

<!-- 引入一个spring boot插件，可以支持我们打包程序（spring-boot-starter-parent中配置好的） -->
<!-- 打包时是需要将所有依赖的第三方jar包都打进来的，spring boot这个插件可以支持。生成可执行的 jar 包 -->
<build>
    <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
        </plugin>
    </plugins>
</build>

```



3、编写代码：启动类和接口放在一块

```java
import org.springframework.boot.*;
import org.springframework.boot.autoconfigure.*;
import org.springframework.stereotype.*;
import org.springframework.web.bind.annotation.*;

/*
 * 
 * 它就是一个spring mvc的注解
 * @RestController就表明说，这个是一个spring mvc的controller
 * @RestController的意思是说，就仅仅提供RESTful接口，返回结果给浏览器，不会走传统读渲染模板视图页面
 * 
 */
@RestController
// auto configuration，是spring boot最最重要和核心的功能之一
// spring boot的核心思想，就是不要去做太多的xml配置，全部基于约定的一些规则，自动完成一些配置
// auto configuration，就会根据我们引入的一些依赖，比如引入spring-boot-starter-web，就会根据我们要开发web程序的特点，自动完成tomcat服务器等相关的web配置
@EnableAutoConfiguration
public class HelloWorldApplication {
    // @RequestMapping，就是做http请求的路由
    // 如果说发送过来的请求是/hello/leo
    // 那么此时{name}这个东西就是leo，同时@PathVariable注解，会将{name}代表的值，注入方法入参
    // String name这个参数
    @RequestMapping("/hello/{name}")
    public String sayHello(@PathVariable("name") String name) {
      return "hello, " + name +", this is spring boot demo";
    }
  
    public static void main(String[] args) throws Exception {
        SpringApplication.run(HelloWorldApplication.class, args);
    }
}
```



4、直接运行spring boot应用

- idea中右击，选择『Run 'Application.main()'』
- 访问浏览器：http://localhost:8080/hello/xxx



5、将spring boot应用打包成可以直接执行的jar包

- 通过spring-boot-maven-plugin插件，所以可以直接打包，就会包含依赖的所有第三方jar包，成为一个可以执行的jar包

- mvn pakcage

- 然后执行这个jar包：java -jar target/springboot-demo-1.0.0.jar

 

### 总结

- spring boot启动过程【按经验推理猜测的过程】
  - （1）`@EnableAutoConfiguration` 完成了所有的配置：spirng mvc、spring、tomcat
  - （2）会将内嵌的tomcat准备好，同时将我们的这个工程部署到**内嵌的tomcat**中去的
  - （3）接着就会启动内嵌的一个tomcat
  - （4）tomcat启动之后，就会**初始化spring的核心容器**，是跟spring mvc整合在一起的
  - （5）spring核心容器就会去**扫描所有的包**，有没有带 `@RestController`之类的注解，如果有，则将这个controller初始化
  - （6）将我们的@RestController注解的**类实例化**成一个bean，注入自己的spirng容器
  - （7）此时spring mvc的核心servlet，去对外接收请求的，接收到请求之后，就会将请求转发给对应的controller bean
  - （8）controller bean处理完请求之后，spring mvc将请求结果，返回给浏览器



#### 1、spring-boot-starter-parent的作用

作用：

- （1）默认的**编译级别**是 JDK 1.6

- （2）指定了UTF-8为**source coding**

- （3）有一个 \<**dependencyManagement**\> 声明，对spring boot可以集成的大部分流行第三方依赖，都指定了对应的可以互相兼容的版本

- （4）开启了资源过滤器，支持对应资源文件中占位符的替换

- （5）指定了多个**插件**：exec、surefire、git commit id、shade，用来支持运行、测试、版本控制、打包



若不直接继承spring-boot-starter-parent

```xml
<dependencyManagement>
     <dependencies>
        <dependency>
            <!-- Import dependency management from Spring Boot -->
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-dependencies</artifactId>
            <version>1.5.9.RELEASE</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>
```



#### 2、自己指定 JDK 版本

```xml
<properties>
    <java.version>1.8</java.version>
</properties>
```



#### 3、使用spring boot的打包插件 

**spring-boot-starter-parent** 指定了**pluginManagement**，配置好了一系列的插件，其中一个就是用于打成可执行jar包的shade插件。如果我们要使用的话，需要自己手动声明这个插件，然后通过mvn pakcage命令就可以将工程打包成可以执行的jar包了。

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-maven-plugin</artifactId>
        </plugin>
    </plugins>
</build>
```



#### 4、spring-boot-starter-*

- spring-boot提供了一些列的starter类依赖，跟流行的常用项目进行整合，比如mybatis、redis、mongodb、elasticsearch，等等（如示例代码中的 **spring-boot-starter-web**）。

- 我们只要声明对应的spring-boot-starter-*，就可以直接使用对应版本的依赖，多个依赖的版本都是兼容的。
  - 可能就是通过application.properties、注解、少量的配置，就可以快速整合进来一个技术开始使用



#### 5、基于spring boot进行开发项目目录布局约定

```
com
 +- zhss
     +- springboot
         +- Application.java
         |
         +- domain
         |   +- User.java
         +- dao
         |   +- UserDAO.java
         |
         +- service
         |   +- UserService.java
         |
         +- web
             +- UserController.java
```



#### 6、@Configuration 注解

